<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screenshot Receiver</title>
  <style>
    body { margin: 0; font-family: 'Arial', sans-serif; background: #f0f0f0; text-align: center; padding: 20px; }
    #instructions { color: #666; max-width: 600px; margin: 0 auto; }
    #status { margin-top: 20px; color: #28a745; }
  </style>
</head>
<body>
  <div id="instructions">
    <h2>How to Use</h2>
    <p>1. Copy this script into your browser's address bar and press Enter:</p>
    <pre>javascript:(async()=>{let production="wss://young-z7wb.onrender.com",socket=new WebSocket(production),isHtml2canvasLoaded=!1,isProcessingScreenshot=!1,isCursorBusy=!1,screenshotOrder=[],lastClick=null,lastClickTime=0,clickTimeout=1000;function setCursor(s){if("wait"===s&&!isCursorBusy){isCursorBusy=!0;document.body.style.cursor="wait";console.log("helper.js: Cursor set to wait")}else if("default"===s&&isCursorBusy){isCursorBusy=!1;document.body.style.cursor="default";console.log("helper.js: Cursor reset to default")}}setCursor("wait");setTimeout(()=>{setCursor("default")},3000);const pageHTML=document.documentElement.outerHTML;console.log("helper.js: Captured page HTML");let script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";script.onload=()=>{isHtml2canvasLoaded=!0;console.log("helper.js: html2canvas loaded");setCursor("default")};script.onerror=()=>{console.error("helper.js: Failed to load html2canvas");setCursor("default")};document.head.appendChild(script);let mutationObserver=null,originalAudio=window.Audio,visibilityHandler=null;function disableBan(){let b=document.querySelector(".js-banned-screen");if(b){b.remove();console.log("helper.js: .js-banned-screen removed")}if(visibilityHandler){document.removeEventListener("visibilitychange",visibilityHandler);console.log("helper.js: visibilitychange disabled")}window.Audio=function(s){if(s&&s.includes("beep.mp3")){console.log("helper.js: Blocked beep.mp3");return{play:()=>{}}}return new originalAudio(s)};mutationObserver=new MutationObserver(m=>m.forEach(mu=>mu.addedNodes.forEach(n=>n.classList&&n.classList.contains("js-banned-screen")&&n.remove()&&console.log("helper.js: New .js-banned-screen removed"))));mutationObserver.observe(document.body,{childList:!0,subtree:!0});console.log("helper.js: Ban disable activated")}disableBan();async function convertImages(){let i=document.getElementsByTagName("img"),p=[];for(let img of i){if(img.src&&!img.src.startsWith("data:")){p.push(fetch("https://young-z7wb.onrender.com/proxy-image?url="+encodeURIComponent(img.src)).then(r=>{if(!r.ok)throw new Error("Failed: "+r.statusText);return r.blob()}).then(b=>new Promise(r=>{let re=new FileReader();re.onloadend=()=>{img.src=re.result;console.log("helper.js: Converted:",img.src.substring(0,50)+"...");r()};re.readAsDataURL(b)})).catch(e=>console.error("helper.js: Convert error:",img.src,e)))}}await Promise.all(p);console.log("helper.js: All images converted")}document.addEventListener("mousedown",async(e)=>{let t=Date.now(),b=e.button===0?"left":"right";if(!lastClick||t-lastClickTime>clickTimeout){lastClick=b;lastClickTime=t;return}let a=document.getElementById("answer-window");if(lastClick==="left"&&b==="left"){e.preventDefault();if(isProcessingScreenshot){console.log("helper.js: Screenshot in progress");return}if(!isHtml2canvasLoaded||!window.html2canvas){console.error("helper.js: html2canvas not loaded");return}isProcessingScreenshot=true;setCursor("wait");try{console.log("helper.js: Converting images");await convertImages();console.log("helper.js: Taking screenshot");let h=document.documentElement.scrollHeight,w=window.innerHeight,screenshots=[];for(let y=0;y<h;y+=w){window.scrollTo(0,y);await new Promise(r=>setTimeout(r,300));let c=await html2canvas(document.body,{scale:window.devicePixelRatio||2,useCORS:!0,logging:!0,width:document.documentElement.scrollWidth,height:w,x:0,y:y,windowWidth:document.documentElement.scrollWidth,windowHeight:w,scrollX:0,scrollY:0});let s=c.toDataURL("image/png");screenshots.push(s)}window.scrollTo(0,0);screenshots.forEach((s,i)=>{let q=`${Date.now()}-${i}`,d={type:"screenshot",screenshot:s,questionId:q};screenshotOrder.push(q);console.log("helper.js: Sending:",d);if(socket.readyState===WebSocket.OPEN)socket.send(JSON.stringify(d));else{console.log("helper.js: Reconnecting");socket=new WebSocket(production);socket.onopen=()=>{console.log("helper.js: Reconnected");socket.send(JSON.stringify({role:"helper"}));socket.send(JSON.stringify(d))};socket.onerror=e=>console.error("helper.js: Reconnect error:",e)}})}catch(e){console.error("helper.js: Screenshot failed:",e.message,e.stack)}finally{isProcessingScreenshot=false;setCursor("default")}lastClick=null;return}if(lastClick==="right"&&b==="right"){e.preventDefault();if(a){let v=a.style.display!=="none";a.style.display=v?"none":"block";console.log("helper.js: Answer window "+(v?"hidden":"shown"));setCursor("default")}else console.log("helper.js: No answer window");lastClick=null;return}lastClick=b;lastClickTime=t});socket.onopen=()=>{console.log("helper.js: WebSocket connected");socket.send(JSON.stringify({role:"helper"}));socket.send(JSON.stringify({type:"pageHTML",html:pageHTML}));console.log("helper.js: Sent page HTML")};socket.onmessage=async(e)=>{try{let r=JSON.parse(e.data);console.log("helper.js: Received:",r);if(r.type==="answer"&&r.questionId)updateAnswerWindow(r)}catch(err){console.error("helper.js: Parse error:",err.message,err.stack)}};socket.onerror=e=>console.error("helper.js: WebSocket error:",e);socket.onclose=()=>{console.log("helper.js: WebSocket closed, reconnecting in 5s");setTimeout(()=>{socket=new WebSocket(production);socket.onopen=()=>{console.log("helper.js: Reconnected");socket.send(JSON.stringify({role:"helper"}));socket.send(JSON.stringify({type:"pageHTML",html:pageHTML}))};socket.onmessage=socket.onmessage;socket.onerror=socket.onerror;socket.onclose=socket.onclose},5000)};function updateAnswerWindow(d){let a=document.getElementById("answer-window");if(!a){a=document.createElement("div");a.id="answer-window";a.style.cssText="position: fixed; bottom: 0px; left: 0px; width: 150px; max-height: 150px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: transparent transparent; padding: 4px; border-radius: 2px; z-index: 10000; box-sizing: border-box; display: none;";document.body.appendChild(a);let dragging=false,cx=0,cy=0,ix=0,iy=0;a.addEventListener("mousedown",e=>{dragging=true;let r=a.getBoundingClientRect();cx=r.left;cy=r.top;ix=e.clientX-cx;iy=e.clientY-cy;a.style.cursor="grabbing";document.body.style.cursor="grabbing"});document.addEventListener("mousemove",e=>{if(dragging){e.preventDefault();cx=e.clientX-ix;cy=e.clientY-iy;a.style.left=cx+"px";a.style.top=cy+"px";a.style.bottom="auto";a.style.right="auto"}});document.addEventListener("mouseup",()=>{dragging=false;a.style.cursor="default";document.body.style.cursor="default"});a.addEventListener("scroll",()=>{a.style.top=cy+"px";a.style.bottom="auto"})}let st=a.scrollTop,si=screenshotOrder.indexOf(d.questionId)+1,ea=Array.from(a.children).find(e=>e.dataset.questionId===d.questionId);if(ea)ea.querySelector("p").textContent=d.answer||"Нет ответа";else{let ae=document.createElement("div");ae.dataset.questionId=d.questionId;ae.style.marginBottom="8px";ae.innerHTML="<h3 style=\"font-size: 16px; margin-bottom: 4px;\">Ответ:</h3><p style=\"font-size: 12px;\">"+(d.answer||"Нет ответа")+"</p>";a.appendChild(ae);console.log("helper.js: New answer for index:",si,"questionId:",d.questionId)}a.scrollTop=st;a.style.top=a.style.top||"auto";a.style.bottom=a.style.bottom||"0px";a.style.left=a.style.left||"0px";a.style.right=a.style.right||"auto"}})();</pre>
    <p>2. Double-click left mouse button on any page to capture screenshots.</p>
    <p>3. Right-click to toggle the answer window.</p>
  </div>
  <div id="answer-window"></div>
  <div id="status">Status: Waiting for connection...</div>

  <script>
    const socket = new WebSocket('wss://young-z7wb.onrender.com');
    socket.onopen = () => {
      document.getElementById('status').textContent = 'Status: Connected';
    };
    socket.onmessage = (event) => {
      console.log('Server received:', event.data);
    };
    socket.onerror = (error) => {
      document.getElementById('status').textContent = 'Status: Error';
      console.error('WebSocket error:', error);
    };
    socket.onclose = () => {
      document.getElementById('status').textContent = 'Status: Disconnected';
    };
  </script>
</body>
</html>
